<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ config['settings'].app_name }} - {{ active_tab or 'Start' }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='tailwind.css') }}" />
    <script defer src="{{ url_for('static', filename='app.js') }}"></script>
  </head>
  <body class="bg-slate-50 text-slate-900 min-h-screen flex flex-col">
    <header class="bg-slate-900 text-white px-6 py-4 shadow-lg">
      <div class="flex items-center justify-between">
        <div>
          <h1 class="text-2xl font-semibold">{{ config['settings'].app_name }}</h1>
          <p class="text-sm opacity-80">Browserbasierte IEC 60870-5-104 Prüfoberfläche</p>
        </div>
        <div class="flex gap-4 items-center text-sm">
          <div class="flex items-center gap-2">
            <span class="inline-block w-2 h-2 rounded-full bg-emerald-400" id="client-status"></span>
            <span>Client</span>
          </div>
          <div class="flex items-center gap-2">
            <span class="inline-block w-2 h-2 rounded-full bg-emerald-400" id="server-status"></span>
            <span>Server</span>
          </div>
        </div>
      </div>
      <nav class="mt-4">
        <ul class="flex gap-6 text-sm">
          {% set tabs = [('Start', url_for('start.index')), ('Prüfung', url_for('pruefung.index')), ('Signallisten', url_for('signallisten.index')), ('Administration', url_for('admin.index'))] %}
          {% for label, href in tabs %}
          <li>
            <a href="{{ href }}" class="pb-2 border-b-2 transition-all {% if active_tab == label %}border-amber-400 text-white{% else %}border-transparent text-slate-300 hover:text-white{% endif %}">{{ label }}</a>
          </li>
          {% endfor %}
        </ul>
      </nav>
    </header>

    <main class="flex-1 flex overflow-hidden">
      <aside class="w-64 bg-white border-r border-slate-200 p-4 overflow-y-auto">
        <h2 class="text-xs uppercase tracking-wide text-slate-500 mb-3">Navigation</h2>
        <ul class="space-y-2 text-sm">
          {% if active_tab == 'Prüfung' %}
          {% set nav = [('Übersicht', 'overview', url_for('pruefung.index')), ('Verbindungen', 'verbindung', url_for('pruefung.verbindung')), ('Sende-Vorlagen', 'senden', url_for('pruefung.senden')), ('Monitor', 'monitor', url_for('pruefung.monitor'))] %}
          {% elif active_tab == 'Signallisten' %}
          {% set nav = [('Übersicht', 'overview', url_for('signallisten.index')), ('Import', 'import', url_for('signallisten.import_view'))] %}
          {% elif active_tab == 'Administration' %}
          {% set nav = [('Allgemein', 'overview', url_for('admin.index'))] %}
          {% else %}
          {% set nav = [('Start', 'overview', url_for('start.index'))] %}
          {% endif %}
          {% for label, key, href in nav %}
          <li>
            <a href="{{ href }}" class="block px-3 py-2 rounded-md {% if section == key %}bg-amber-100 text-amber-800 font-medium{% else %}hover:bg-slate-100{% endif %}">{{ label }}</a>
          </li>
          {% endfor %}
        </ul>
      </aside>

      <section class="flex-1 overflow-y-auto p-6">
        {% block content %}{% endblock %}
      </section>

      <aside class="w-96 bg-slate-900 text-slate-100 border-l border-slate-800 flex flex-col">
        <div class="p-4 border-b border-slate-800 flex items-center justify-between">
          <h2 class="text-sm font-semibold">Live IEC-104 Frames</h2>
          <button id="clear-stream" class="text-xs uppercase tracking-wide text-amber-400 hover:text-amber-200">Leeren</button>
        </div>
        <div class="p-4 border-b border-slate-800">
          <form id="stream-filter" class="space-y-2 text-xs">
            <div class="flex gap-2">
              <label class="flex-1">Rolle
                <select name="role" class="mt-1 w-full bg-slate-800 border border-slate-700 rounded px-2 py-1">
                  <option value="">Alle</option>
                  <option value="client">Client</option>
                  <option value="server">Server</option>
                </select>
              </label>
              <label class="flex-1">Richtung
                <select name="dir" class="mt-1 w-full bg-slate-800 border border-slate-700 rounded px-2 py-1">
                  <option value="">Alle</option>
                  <option value="tx">TX</option>
                  <option value="rx">RX</option>
                </select>
              </label>
            </div>
            <div class="grid grid-cols-2 gap-2">
              <label>TI
                <input name="ti" type="number" class="mt-1 w-full bg-slate-800 border border-slate-700 rounded px-2 py-1" />
              </label>
              <label>COT
                <input name="cot" type="number" class="mt-1 w-full bg-slate-800 border border-slate-700 rounded px-2 py-1" />
              </label>
            </div>
            <div class="grid grid-cols-2 gap-2">
              <label>IOA
                <input name="ioa" type="text" class="mt-1 w-full bg-slate-800 border border-slate-700 rounded px-2 py-1" placeholder="Teilstring" />
              </label>
              <label>Suche
                <input name="search" type="text" class="mt-1 w-full bg-slate-800 border border-slate-700 rounded px-2 py-1" placeholder="Volltext" />
              </label>
            </div>
          </form>
        </div>
        <div id="stream-container" class="flex-1 overflow-y-auto p-4 space-y-3 text-xs"></div>
      </aside>
    </main>

    <footer class="bg-slate-200 text-slate-600 text-xs px-6 py-3">
      <div class="flex justify-between">
        <span>Version 0.1.0</span>
        <span>Nur WebSocket Transport &bull; IEC 60870-5-104 Testumgebung</span>
      </div>
    </footer>
  </body>
</html>
